# waitingQueue

대기열 시스템 만들어보기

## 기본 개념

특정 이벤트가 오픈되었을때, 한번에 많은 요청이 들어올 수 있다.
이때, 요청에 대한 처리를 순차적으로 하기 위해 대기열을 부여하고 순차적으로 처리하는 시스템을 구상하였다.

## 구현 방법

![image1.png](./assets/image1.png)

1. 사용자는 페이지에 접속하여 요청을 보낸다.
2. 서버는 요청을 받은 뒤 대기 순번을 부여하고 사용자에게 응답을 보낸다.
   1. redis Sorted Set에 timestamp를 Score로 하여 대기열을 만든다. 
   2. 클라이언트는 대기화면으로 리다이렉트 되고 인입 서버와 웹소켓을 통해 연결을 맺는다.
   3. 클라이언트는 주기적으로 서버측으로부터 현재 대기열 순서를 요청한다.
3. 워커 서버는 대기열에 있는 요청을 반복적으로 가져오고 순차적으로 처리한다.
   1. 서버당 10개의 쓰레드를 만들어 각 쓰레드가 반복적으로 ZPOPMIN 명령어를 통해 티켓을 가져온다.
   2. 해당 티켓 작업이 완료되면 Redis에 publish를 통해 완료되었음을 알린다.
4. 인입 서버는 subscribe를 통해 완료되었음을 전달 받아 웹 소켓을 통해 클라이언트에게 전달한다.


## 시연 화면
